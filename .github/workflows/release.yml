name: Bump Homebrew formula

on:
  repository_dispatch:
    types: [update-formula]
  workflow_dispatch:
    inputs:
      formula_previous_version:
        description: "Previous version of the formula"
        required: true
        type: string
      formula_new_version:
        description: "New version of the formula"
        required: true
        type: string
      formula_name:
        description: "Name of the formula"
        required: true
        type: string
      formula_url:
        description: "URL of the formula"
        required: true
        type: string

jobs:
  bump-homebrew-formula:
    name: Bump Homebrew formula
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout source repository
        uses: actions/checkout@v4

      - uses: mislav/bump-homebrew-formula-action@v3
        with:
          formula-name: ${{ env.FORMULA_NAME }}
          formula-path: Formula/${{ env.FORMULA_NAME }}.rb
          download-url: ${{ env.FORMULA_URL }}
          homebrew-tap: ${{ github.repository }}
          tag-name: v${{ env.FORMULA_NEW_VERSION }}
          base-branch: master
          commit-message: ${{ env.FORMULA_NAME }} ${{ env.FORMULA_NEW_VERSION }}
        env:
          COMMITTER_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          FORMULA_PREVIOUS_VERSION: ${{ github.event_name == 'repository_dispatch' && github.event.client_payload.formula_previous_version || inputs.formula_previous_version }}
          FORMULA_NEW_VERSION: ${{ github.event_name == 'repository_dispatch' && github.event.client_payload.formula_new_version || inputs.formula_new_version }}
          FORMULA_NAME: ${{ github.event_name == 'repository_dispatch' && github.event.client_payload.formula_name || inputs.formula_name }}
          FORMULA_URL: ${{ github.event_name == 'repository_dispatch' && github.event.client_payload.formula_url || inputs.formula_url }}
